<?xml version="1.0"?>
<!--
 Copyright (C) 2022 Canonical Ltd

 This library is free software; you can redistribute it and/or
 modify it under the terms of the GNU Lesser General Public
 License as published by the Free Software Foundation; either
 version 2 of the License, or (at your option) any later version.

 This library is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 Lesser General Public License for more details.

 You should have received a copy of the GNU Lesser General Public
 License along with this library. If not, see <http://www.gnu.org/licenses/>.
-->

<node name="/" xmlns:doc="http://www.freedesktop.org/dbus/1.0/doc.dtd">
  <!--
      org.freedesktop.portal.WebExtensions:
      @short_description: WebExtensions portal

      The WebExtensions portal allows sandboxed web browsers to start
      native messaging servers installed on the host system.

      This documentation describes version 1 of this interface.
  -->
  <interface name="org.freedesktop.portal.WebExtensions">
    <!--
        CreateSession:
        @options: Vardict with optional further information
        @session_handle: Object path for the #org.freedesktop.portal.Session created by this call.

        Create a web extensions session. A successfully created
        session can at any time be closed using
        org.freedesktop.portal.Session::Close, or may at any time be
        closed by the portal implementation, which will be signalled
        via org.freedesktop.portal.Session::Closed.

        Supported keys in the @options vardict include:
        <variablelist>
          <varlistentry>
            <term>mode s</term>
            <listitem><para>
              A string indicating which behaviour the portal should
              use when locating and starting native messaging
              servers. Valid values are "mozilla" and "chromium". By
              default, mozilla behaviour is used.
            </para></listitem>
          </varlistentry>
          <varlistentry>
            <term>session_handle_token s</term>
            <listitem><para>
              A string that will be used as the last element of the session handle. Must be a valid
              object path element. See the #org.freedesktop.portal.Session documentation for
              more information about the session handle.
            </para></listitem>
          </varlistentry>
        </variablelist>
    -->
    <method name="CreateSession">
      <arg type="a{sv}" name="options" direction="in"/>
      <arg type="o" name="session_handle" direction="out"/>
    </method>
    <!--
        GetManifest:
        @session_handle: Object path for the #org.freedesktop.portal.Session object
        @name: name of the native messaging server
        @extension_or_origin: extension ID or origin URI identifying the extension
        @json_manifest: the JSON manifest for the native messaging server

        Return the JSON manifest of the native messaging server that
        Start would invoke.
    -->
    <method name="GetManifest">
      <arg type="o" name="session_handle" direction="in"/>
      <arg type="s" name="name" direction="in"/>
      <arg type="s" name="extension_or_origin" direction="in"/>
      <arg type="s" name="json_manifest" direction="out"/>
    </method>
    <!--
        Start:
        @session_handle: Object path for the #org.freedesktop.portal.Session object
        @name: name of the native messaging server
        @extension_or_origin: extension ID or origin URI identifying the extension
        @options: Vardict with optional further information
        @handle: Object path for the #org.freedesktop.portal.Request object representing this call

        Start the named native messaging server. The caller must
        indicate the requesting web extension (either by extension ID
        for Firefox, or origin URI for Chrome), which will be matched
        against the server's access control list.

        If the server can't be started, or invalid data is provided,
        the session will be closed.

        Supported keys in the @options vardict include:
        <variablelist>
          <varlistentry>
            <term>handle_token s</term>
            <listitem><para>
              A string that will be used as the last element of the @handle. Must be a valid
              object path element. See the #org.freedesktop.portal.Request documentation for
              more information about the @handle.
            </para></listitem>
          </varlistentry>
        </variablelist>
    -->
    <method name="Start">
      <arg type="o" name="session_handle" direction="in"/>
      <arg type="s" name="name" direction="in"/>
      <arg type="s" name="extension_or_origin" direction="in"/>
      <arg type="a{sv}" name="options" direction="in"/>
      <arg type="o" name="handle" direction="out"/>
    </method>
    <!--
        GetPipes:
        @session_handle: Object path for the #org.freedesktop.portal.Session object
        @options: Vardict with optional further information
        @stdin: File descriptor representing the server's stdin.
        @stdout: File descriptor representing the server's stdout.
        @stderr: File descriptor representing the server's stderr.

        Retrieve file descriptors for the native messaging server
        identified by the session. This method should only be called
        after the Start request recveives a successful response.
    -->
    <method name="GetPipes">
      <annotation name="org.gtk.GDBus.C.UnixFD" value="true"/>
      <arg type="o" name="session_handle" direction="in"/>
      <arg type="a{sv}" name="options" direction="in"/>
      <arg type="h" name="stdin" direction="out"/>
      <arg type="h" name="stdout" direction="out"/>
      <arg type="h" name="stderr" direction="out"/>
    </method>
    <property name="version" type="u" access="read"/>
  </interface>
</node>
